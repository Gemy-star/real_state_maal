{% extends 'base.html' %}
{% load static i18n %}
{% block style %}
<style>
  .reports-section {
    background: linear-gradient(135deg, #CEC9BB 0%, #e8e4dc 100%);
    min-height: 100vh;
    padding: 8rem 0 4rem 0;
  }

  .page-header {
    margin-bottom: 3rem;
    padding-top: 2rem;
  }

  .page-header .title-single {
    font-size: 2.5rem;
    font-weight: 700;
    color: #392E37;
    position: relative;
    display: inline-block;
  }

  .page-header .title-single::after {
    content: '';
    position: absolute;
    bottom: -10px;
    right: 50%;
    transform: translateX(50%);
    width: 80px;
    height: 4px;
    background: linear-gradient(90deg, #6c5ce7, #a29bfe);
    border-radius: 2px;
  }

  .page-subtitle {
    color: #666;
    font-size: 1.1rem;
    margin-top: 1.5rem;
  }

  /* Report Cards */
  .report-card {
    background: #fff;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    cursor: pointer;
    border: none;
    height: 100%;
  }

  .report-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
  }

  .report-card-header {
    background: linear-gradient(135deg, #392E37 0%, #5a4a54 100%);
    padding: 2rem;
    text-align: center;
    position: relative;
    overflow: hidden;
  }

  .report-card-header::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
    animation: shimmer 3s infinite;
  }

  @keyframes shimmer {
    0%, 100% { transform: rotate(0deg); }
    50% { transform: rotate(180deg); }
  }

  .report-year {
    font-size: 3rem;
    font-weight: 800;
    color: #fff;
    margin: 0;
    position: relative;
    z-index: 1;
  }

  .report-card-body {
    padding: 1.5rem;
    text-align: center;
  }

  .report-title {
    font-size: 1.1rem;
    color: #392E37;
    font-weight: 600;
    margin-bottom: 1rem;
  }

  .report-icon {
    font-size: 2.5rem;
    color: #6c5ce7;
    margin-bottom: 1rem;
  }

  .btn-view-report {
    background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
    color: #fff;
    border: none;
    padding: 0.75rem 2rem;
    border-radius: 30px;
    font-weight: 600;
    transition: all 0.3s ease;
    width: 100%;
  }

  .btn-view-report:hover {
    background: linear-gradient(135deg, #5b4cdb 0%, #8f85f3 100%);
    color: #fff;
    transform: scale(1.02);
  }

  /* Modal Styles */
  .modal-content {
    border-radius: 20px;
    border: none;
    overflow: hidden;
  }

  .modal-header {
    background: linear-gradient(135deg, #392E37 0%, #5a4a54 100%);
    color: #fff;
    border: none;
    padding: 1.5rem 2rem;
  }

  .modal-header .btn-close {
    filter: invert(1);
    opacity: 0.8;
  }

  .modal-header .btn-close:hover {
    opacity: 1;
  }

  .modal-title {
    font-weight: 700;
    font-size: 1.4rem;
  }

  .modal-body {
    padding: 0;
  }

  .report-iframe-container {
    width: 100%;
    height: 75vh;
    background: #f5f5f5;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .report-iframe-container iframe {
    width: 100%;
    height: 100%;
    border: none;
  }

  .modal-footer {
    border: none;
    padding: 1rem 2rem;
    background: #f8f9fa;
  }

  .btn-download {
    background: linear-gradient(135deg, #00875a 0%, #00a66e 100%);
    color: #fff;
    border: none;
    padding: 0.75rem 2rem;
    border-radius: 30px;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .btn-download:hover {
    background: linear-gradient(135deg, #006b47 0%, #008558 100%);
    color: #fff;
    transform: scale(1.02);
  }

  .btn-close-modal {
    background: #6c757d;
    color: #fff;
    border: none;
    padding: 0.75rem 2rem;
    border-radius: 30px;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .btn-close-modal:hover {
    background: #5a6268;
    color: #fff;
  }

  /* Loading Spinner */
  .loading-spinner {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
  }

  .spinner-border {
    width: 3rem;
    height: 3rem;
    color: #6c5ce7;
  }

  @media (max-width: 768px) {
    .page-header .title-single {
      font-size: 1.8rem;
    }

    .report-year {
      font-size: 2.5rem;
    }

    .report-iframe-container {
      height: 60vh;
    }
  }
</style>
{% endblock %}

{% block body %}
<main id="main" class="reports-section">
  <div class="container">
    <!-- Page Header -->
    <div class="row justify-content-center page-header">
      <div class="col-12 text-center">
        <h1 class="title-single">تقارير مجلس الإدارة</h1>
        <p class="page-subtitle">اطلع على التقارير السنوية لمجلس الإدارة</p>
      </div>
    </div>

    <!-- Reports Grid -->
    <div class="row g-4 justify-content-center">
      {% for report in reports %}
      <!-- Report {{ report.year }} -->
      <div class="col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="{{ forloop.counter0|add:'00' }}">
        <div class="report-card">
          <div class="report-card-header">
            <h2 class="report-year">{{ report.year }}</h2>
          </div>
          <div class="report-card-body">
            <div class="report-icon">
              <i class="bi bi-file-earmark-pdf"></i>
            </div>
            <h3 class="report-title">{{ report.title }}</h3>
            {% if report.description %}
            <p class="text-muted small">{{ report.description|truncatewords:20 }}</p>
            {% endif %}
            <button type="button" class="btn btn-view-report" onclick="openReportModal('{{ report.year }}', '{{ report.pdf_url }}')">
              <i class="bi bi-eye me-2"></i>
              {% trans "عرض التقرير" %}
            </button>
          </div>
        </div>
      </div>
      {% empty %}
      <div class="col-12 text-center">
        <div class="alert alert-info">
          <i class="bi bi-info-circle me-2"></i>
          {% trans "لا توجد تقارير متاحة حالياً" %}
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</main>

<!-- Report Modal -->
<div class="modal fade" id="reportModal" tabindex="-1" aria-labelledby="reportModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="reportModalLabel">
          <i class="bi bi-file-earmark-pdf me-2"></i>
          {% trans "التقرير السنوي" %} <span id="modalReportYear"></span>
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{% trans 'إغلاق' %}"></button>
      </div>
      <div class="modal-body">
        <div class="report-iframe-container" id="reportContainer">
          <div class="loading-spinner" id="loadingSpinner">
            <div class="spinner-border" aria-hidden="true"></div>
            <output>جاري تحميل التقرير...</output>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <a href="#" id="downloadBtn" class="btn btn-download" download>
          <i class="bi bi-download me-2"></i>
          {% trans "تحميل التقرير" %}
        </a>
        <button type="button" class="btn btn-close-modal" data-bs-dismiss="modal">
          <i class="bi bi-x-lg me-2"></i>
          {% trans "إغلاق" %}
        </button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block js %}
<script>
  let currentReportUrl = '';
  // Translatable strings
  const translations = {
    loadingReport: "{% trans 'جاري تحميل التقرير...' %}",
    annualReport: "{% trans 'التقرير السنوي' %}",
    cannotDisplay: "{% trans 'لا يمكن عرض الملف.' %}",
    openInNewWindow: "{% trans 'فتح في نافذة جديدة' %}",
    or: "{% trans 'أو' %}",
    download: "{% trans 'تحميل' %}"
  };

  function openReportModal(year, pdfUrl) {
    currentReportUrl = pdfUrl;

    // Update modal title
    document.getElementById('modalReportYear').textContent = year;

    // Update download button
    document.getElementById('downloadBtn').href = pdfUrl;

    // Show loading spinner
    const container = document.getElementById('reportContainer');
    container.innerHTML = `
      <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner-border" aria-hidden="true"></div>
        <output>${translations.loadingReport}</output>
      </div>
    `;

    // Show modal
    const modal = new bootstrap.Modal(document.getElementById('reportModal'));
    modal.show();

    // Load PDF after a brief delay to show loading state
    setTimeout(() => {
      container.innerHTML = `<object data="${pdfUrl}" type="application/pdf" style="width:100%;height:100%;" title="${translations.annualReport} ${year}">
        <p style="text-align:center;padding:3rem;">
          <i class="bi bi-exclamation-triangle text-warning" style="font-size:2rem;display:block;margin-bottom:1rem;"></i>
          ${translations.cannotDisplay}
          <a href="${pdfUrl}" target="_blank">${translations.openInNewWindow}</a>
          ${translations.or}
          <a href="${pdfUrl}" download>${translations.download}</a>
        </p>
      </object>`;
    }, 500);
  }

  // Clean up iframe when modal is closed
  document.getElementById('reportModal').addEventListener('hidden.bs.modal', function () {
    document.getElementById('reportContainer').innerHTML = `
      <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner-border" aria-hidden="true"></div>
        <output>${translations.loadingReport}</output>
      </div>
    `;
  });
</script>
{% endblock %}
