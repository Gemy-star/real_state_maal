{% load static i18n formatter_tags %}

<nav id="navbar" class="navbar navbar-expand-lg fixed-top custom-navbar">
  <div class="container">
    <!-- Brand / Logo -->
    <a class="navbar-brand text-brand" href="{% url 'home-page' %}">
      <img src="{% static 'assets/img/logo_white.png' %}" 
           class="img-fluid logo" 
           alt="Logo" />
    </a>

    <!-- Hamburger / Toggler -->
    <button class="navbar-toggler collapsed border-0" 
            type="button" 
            data-bs-toggle="collapse" 
            data-bs-target="#navbarDefault" 
            aria-controls="navbarDefault" 
            aria-expanded="false" 
            aria-label="Toggle navigation">
      <span class="toggler-icon top-bar"></span>
      <span class="toggler-icon middle-bar"></span>
      <span class="toggler-icon bottom-bar"></span>
    </button>

    <!-- Navbar Links -->
    <div class="collapse navbar-collapse justify-content-center" id="navbarDefault">
      <ul class="navbar-nav align-items-center">

        <li class="nav-item">
          <a class="nav-link {% if request.resolver_match.url_name|startswith:'home-page' %} active {% endif %}" 
             href="{% url 'home-page' %}">{% trans "الرئيسية" %}</a>
        </li>

        <!-- علاقات المستثمرين -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle {% if request.resolver_match.url_name|startswith:'services-page' %} active {% endif %}" 
             href="#" id="investorRelationsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            {% trans "علاقات المستثمرين" %}
          </a>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="investorRelationsDropdown">
            <li><a class="dropdown-item" href="{% url 'reports-page' %}">{% trans "تقارير مجلس الإدارة" %}</a></li>
            <li><a class="dropdown-item" href="{% url 'services-page' %}">{% trans "الجمعيات العامة لمساهمين الشركة" %}</a></li>
            <li><a class="dropdown-item" href="{% url 'maal-page' %}">{% trans "القوائم المالية" %}</a></li>
          </ul>
        </li>

        <!-- الحوكمة -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle {% if request.resolver_match.url_name|startswith:'services-page' %} active {% endif %}" 
             href="#" id="governanceDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            {% trans "الحوكمة" %}
          </a>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="governanceDropdown">
            <li><a class="dropdown-item" href="{% static 'assets/thimar_system.pdf' %}">{% trans "النظام الأساس للشركة" %}</a></li>
            <li><a class="dropdown-item" href="{% url 'privacy-page' %}">{% trans "سياسة الإبلاغ عن المخالفات" %}</a></li>
            <li><a class="dropdown-item" href="#">{% trans "سياسة المسؤولية الاجتماعية ومبادرة العمل الاجتماعي" %}</a></li>
          </ul>
        </li>

        <li class="nav-item">
          <a class="nav-link {% if request.resolver_match.url_name|startswith:'who-page' %} active {% endif %}" 
             href="{% url 'who-page' %}">{% trans "استثماراتنا" %}</a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.resolver_match.url_name|startswith:'about-page' %} active {% endif %}" 
             href="{% url 'about-page' %}">{% trans "من نحن" %}</a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if request.resolver_match.url_name|startswith:'contact-page' %} active {% endif %}" 
             href="{% url 'contact-page' %}">{% trans "المركز الإعلامي" %}</a>
        </li>

        <!-- Language Switcher -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="languageDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            🌐 {% get_current_language as LANGUAGE_CODE %}
            {% if LANGUAGE_CODE == "ar" %} العربية {% else %} English {% endif %}
          </a>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="languageDropdown">
            <li>
              <form action="{% url 'set_language' %}" method="post">
                {% csrf_token %}
                <input type="hidden" name="language" value="ar">
                <button type="submit" class="dropdown-item">العربية</button>
              </form>
            </li>
            <li>
              <form action="{% url 'set_language' %}" method="post">
                {% csrf_token %}
                <input type="hidden" name="language" value="en">
                <button type="submit" class="dropdown-item">English</button>
              </form>
            </li>
          </ul>
        </li>

      </ul>
    </div>
  </div>
</nav>

<!-- Custom CSS -->
<style>
.custom-navbar {
  background: linear-gradient(90deg, #392E37, #4c3c4f);
  padding: 0.8rem 1rem;
  transition: all 0.3s ease;
}
.custom-navbar .logo {
  max-width: 6rem;
  max-height: 7vh;
}
.navbar-nav .nav-link {
  color: #f5f5f5;
  font-weight: 500;
  padding: 0.6rem 1rem;
  transition: color 0.3s ease, transform 0.2s ease;
}
.navbar-nav .nav-link:hover,
.navbar-nav .nav-link.active {
  color: #FFD369;
  transform: translateY(-2px);
}

/* Dropdown */
.dropdown-menu {
  border-radius: 0.6rem;
  border: none;
  box-shadow: 0 6px 20px rgba(0,0,0,0.15);
  padding: 0.5rem;
  text-align: right;
}
.dropdown-item {
  padding: 0.6rem 1rem;
  color: #333;
  transition: background 0.2s;
}
.dropdown-item:hover {
  background: #f8f9fa;
  border-radius: 0.4rem;
}

/* Hamburger bars */
.toggler-icon {
  display: block;
  width: 24px;
  height: 3px;
  margin: 5px auto;
  transition: all 0.3s ease-in-out;
  background-color: #CEC9BB;
  border-radius: 2px;
}

/* Hamburger animation */
.navbar-toggler.collapsed .toggler-icon.top-bar { transform: rotate(0); }
.navbar-toggler:not(.collapsed) .toggler-icon.top-bar { transform: rotate(45deg) translateY(7px); }
.navbar-toggler:not(.collapsed) .toggler-icon.middle-bar { opacity: 0; }
.navbar-toggler:not(.collapsed) .toggler-icon.bottom-bar { transform: rotate(-45deg) translateY(-7px); }
</style>

<!-- Mobile Dropdown Fix -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  // Mobile dropdown toggle
  document.querySelectorAll(".nav-item.dropdown > .dropdown-toggle").forEach(function(dropdown) {
    dropdown.addEventListener("click", function(e) {
      if (window.innerWidth < 992) {
        e.preventDefault();
        let parent = this.parentElement;
        parent.classList.toggle("show");
        let menu = parent.querySelector(".dropdown-menu");
        menu.classList.toggle("show");
      }
    });
  });

  // Close dropdowns when clicking outside
  document.addEventListener("click", function(e) {
    document.querySelectorAll(".nav-item.dropdown.show").forEach(function(dropdown) {
      if (!dropdown.contains(e.target)) {
        dropdown.classList.remove("show");
        dropdown.querySelector(".dropdown-menu").classList.remove("show");
      }
    });
  });

  // Collapse navbar when link clicked on mobile
  document.querySelectorAll('.navbar-collapse .nav-link').forEach(function(link) {
    link.addEventListener('click', function() {
      if (window.innerWidth < 992) {
        let navbarCollapse = document.getElementById('navbarDefault');
        if (navbarCollapse.classList.contains('show')) {
          new bootstrap.Collapse(navbarCollapse).toggle();
        }
      }
    });
  });
});
</script>
